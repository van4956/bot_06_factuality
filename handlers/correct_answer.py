import logging

# Инициализируем логгер модуля
logger = logging.getLogger(__name__)
logger.setLevel(logging.INFO)
logger.info("Загружен модуль: %s", __name__)

from icecream import ic
ic.configureOutput(includeContext=True, prefix=' >>> Debag >>> ')

from aiogram import Router, F
from sqlalchemy.ext.asyncio import AsyncSession
from aiogram.fsm.context import FSMContext
from aiogram.fsm.state import StatesGroup, State
from aiogram.types import Message, CallbackQuery
from aiogram.utils.i18n import gettext as _
from aiogram.utils.i18n import lazy_gettext as __

from common import keyboard
from database.orm_answers import orm_get_answer

# Инициализируем роутер уровня модуля
correct_answer_router = Router()

# Определяем состояния
class TestCorrectAnswerStates(StatesGroup):
    QUESTION_START = State()
    QUESTION_PROCESS = State()

# correct_answers = {
#     1 : ("Вопрос: 1\n\nСколько девочек сегодня оканчивают начальную школу в странах с низким уровнем доходов?\n\n"
#         "1) 20 процентов\n"
#         "2) 40 процентов\n"
#         "3) 60 процентов\n\n"
#         "Правильный ответ: 60 процентов\n"
#         "Ваш ответ: {user_answer}\n\n"
#         "<i>Объяснение: Многие думают, что доступ девочек к образованию в бедных странах ограничен, но это уже не так. "
#         "За последние десятилетия глобальные инициативы, такие как программы ООН и ВОЗ, "
#         "существенно увеличили доступ к образованию, особенно среди девочек. "
#         "Сегодня большинство девочек в странах с низким уровнем доходов оканчивают начальную школу, "
#         "что свидетельствует об огромных улучшениях в области образования.</i>"),
#     2 : ("Вопрос: 2\n\nГде живет большая часть населения мира?\n\n"
#         "1) В странах с низким уровнем доходов\n"
#         "2) В странах со средним уровнем доходов\n"
#         "3) В странах с высоким уровнем доходов\n\n"
#         "Правильный ответ: В странах со средним уровнем доходов\n"
#         "Ваш ответ: {user_answer}\n\n"
#         "<i>Объяснение: Раньше мир действительно был разделён на «богатые» и «бедные» страны, но сейчас большая часть населения "
#         "живёт в странах со средним уровнем доходов. Это Китай, Индия и многие другие страны, "
#         "где экономический рост помог миллиардам людей подняться из крайней нищеты. Большинство людей имеют доступ к базовым благам, "
#         "таким как электричество, вода и образование, что подтверждает этот факт.</i>"),
#     3 : ("Вопрос 3:\n\nЗа последние 20 лет доля мирового населения, живущего в нищете...\n\n"
#         "1) ...почти удвоилась\n"
#         "2) ...осталась почти неизменной\n"
#         "3) ...сократилась почти вдвое\n\n"
#         "Правильный ответ: ...сократилась почти вдвое\n"
#         "Ваш ответ: {user_answer}\n\n"
#         "<i>Объяснение: Это один из самых впечатляющих успехов последних десятилетий. Улучшения в сельском хозяйстве, "
#         "глобальная торговля и международные программы помощи позволили миллиардам людей выбраться из бедности. "
#         "Хотя многие всё ещё живут за чертой бедности, сокращение её уровня в два раза за 20 лет — это значительный прогресс.</i>"),
#     4 : ("Вопрос 4:\n\nКакова сегодня ожидаемая продолжительность жизни в мире?\n\n"
#         "1) 50 лет\n"
#         "2) 60 лет\n"
#         "3) 70 лет\n\n"
#         "Правильный ответ: 70 лет\n"
#         "Ваш ответ: {user_answer}\n\n"
#         "<i>Объяснение: Ожидаемая продолжительность жизни резко увеличилась благодаря глобальному прогрессу в медицине, "
#         "вакцинации и улучшению санитарных условий. Даже в беднейших странах средняя продолжительность жизни выросла. "
#         "Это показывает, насколько быстро могут меняться условия жизни при доступе к базовым благам.</i>"),
#     5 : ("Вопрос 5:\n\nСегодня в мире насчитывается 2 миллиарда детей в возрасте от 0 до 15 лет. Сколько детей, согласно прогнозу ООН, будет в мире в 2100 году?\n\n"
#         "1) 4 миллиарда\n"
#         "2) 3 миллиарда\n"
#         "3) 2 миллиарда\n\n"
#         "Правильный ответ: 2 миллиарда\n"
#         "Ваш ответ: {user_answer}\n\n"
#         "<i>Объяснение: Уровень рождаемости по всему миру стабилизировался. "
#         "В странах с низким доходом семьи уже не стремятся иметь много детей, так как улучшаются здравоохранение и детская смертность. "
#         "Это стабилизация числа детей означает, что рост населения будет происходить за счёт увеличения продолжительности жизни, "
#         "а не из-за роста рождаемости.</i>"),
#     6 : ("Вопрос 6:\n\nПо прогнозам ООН, к 2100 году население земного шара увеличится на 4 миллиарда человек. За счет чего это произойдет?\n\n"
#         "1) Будет больше детей (до 15 лет)\n"
#         "2) Будет больше взрослых (от 15 до 74 лет)\n"
#         "3) Будет больше стариков (от 75 лет)\n\n"
#         "Правильный ответ: Будет больше взрослых (от 15 до 74 лет)\n"
#         "Ваш ответ: {user_answer}\n\n"
#         "<i>Объяснение: Основной прирост произойдёт за счёт увеличения числа взрослых людей, "
#         "которые будут жить дольше благодаря улучшению здравоохранения. "
#         "Количество детей останется стабильным, а доля пожилых людей тоже будет увеличиваться, но более медленно.</i>"),
#     7 : ("Вопрос 7:\n\nКак за последние 100 лет изменилось количество смертей в год, вызванных стихийными бедствиями?\n\n"
#         "1) Увеличилось более чем в два раза\n"
#         "2) Осталось почти неизменным\n"
#         "3) Уменьшилось более чем в два раза\n\n"
#         "Правильный ответ: Уменьшилось более чем в два раза\n"
#         "Ваш ответ: {user_answer}\n\n"
#         "<i>Объяснение: Благодаря развитию технологий прогнозирования, улучшению инфраструктуры и международной помощи, "
#         "количество смертей от стихийных бедствий сократилось. Сегодня мы способны заранее готовиться к ураганам, "
#         "землетрясениям и другим катастрофам, снижая их последствия.</i>"),
#     8 : ("Вопрос 8:\n\nСегодня население земного шара составляет около 7 миллиардов человек. Какая карта лучше всего показывает их распределение?\n\n"
#         "1) Карта I\n"
#         "2) Карта II\n"
#         "3) Карта III\n\n"
#         "Правильный ответ: Карта I\n"
#         "Ваш ответ: {user_answer}\n\n"
#         "<i>Объяснение: Большинство населения проживает в Азии, что делает распределение людей очень неоднородным. "
#         "Около 4 миллиардов человек живут в Индии, Китае и других азиатских странах. "
#         "Карта I лучше всего отражает этот факт, показывая плотное население в соответствующих регионах.</i>"),
#     9 : ("Вопрос 9:\n\nСколько годовалых детей в мире прививается сегодня от каких-либо болезней?\n\n"
#         "1) 20 процентов\n"
#         "2) 50 процентов\n"
#         "3) 80 процентов\n\n"
#         "Правильный ответ: 80 процентов\n"
#         "Ваш ответ: {user_answer}\n\n"
#         "<i>Объяснение: Вопреки распространённым мифам, большинство детей в мире получают базовые прививки. "
#         "Это стало возможным благодаря международным программам, таким как Глобальный альянс по вакцинам (GAVI), и поддержке со стороны ВОЗ. "
#         "Эти усилия помогли уменьшить уровень детской смертности и предотвратить многие заболевания.</i>"),
#     10 : ("Вопрос 10:\n\nВ среднем по миру к 30 годам мужчины тратят на учебу 10 лет своей жизни. Сколько лет тратят на учебу к тому же возрасту женщины?\n\n"
#         "1) 9 лет\n"
#         "2) 6 лет\n"
#         "3) 3 года\n\n"
#         "Правильный ответ: 9 лет\n"
#         "Ваш ответ: {user_answer}\n\n"
#         "<i>Объяснение: Разрыв в образовании между мужчинами и женщинами существенно сократился за последние десятилетия. "
#         "Сегодня девочки имеют почти такие же возможности для обучения, как и мальчики, что способствует улучшению их положения в обществе.</i>"),
#     11 : ("Вопрос 11:\n\nВ 1996 году тигры, гигантские панды и черные носороги вошли в список вымирающих видов. Сколько из этих трёх видов сегодня находятся под угрозой исчезновения?\n\n"
#         "1) Два\n"
#         "2) Один\n"
#         "3) Ни одного\n\n"
#         "Правильный ответ: Ни одного\n"
#         "Ваш ответ: {user_answer}\n\n"
#         "<i>Объяснение: Усилия по сохранению природы, такие как создание заповедников и борьба с браконьерством, позволили восстановить численность этих видов. "
#         "Хотя угрозы полностью не исчезли, они больше не находятся на грани исчезновения, что является результатом глобальных природоохранных инициатив.</i>"),
#     12 : ("Вопрос 12:\n\nСколько человек в мире имеют доступ к электричеству?\n\n"
#         "1) 20 процентов\n"
#         "2) 50 процентов\n"
#         "3) 80 процентов\n\n"
#         "Правильный ответ: 80 процентов\n"
#         "Ваш ответ: {user_answer}\n\n"
#         "<i>Объяснение: Сегодня около 80% мирового населения имеют доступ к электричеству. "
#         "Это стало возможным благодаря развитию энергетической инфраструктуры, даже в отдалённых районах. "
#         "Этот показатель особенно заметно улучшился в странах с низким уровнем доходов.</i>"),
#     13 : ("Вопрос 13:\n\nЭксперты по глобальному климату считают, что в течение следующих 100 лет средняя температура...\n\n"
#         "1) ...повысится\n"
#         "2) ...останется неизменной\n"
#         "3) ...понизится\n\n"
#         "Правильный ответ: ...повысится\n"
#         "Ваш ответ: {user_answer}\n\n"
#         "<i>Объяснение: Из-за увеличения концентрации парниковых газов в атмосфере глобальное потепление продолжит набирать обороты. "
#         "Учёные прогнозируют рост температуры, если не будут приняты меры по сокращению выбросов CO₂ и других вредных веществ.</i>")
# }


# Константы для каждого вопроса с объяснением
ANSWER_TEXT_1 = __("""Вопрос: 1\n\nСколько девочек сегодня оканчивают начальную школу в странах с низким уровнем доходов?\n\n1) 20 процентов\n2) 40 процентов\n3) 60 процентов\n\nПравильно: 60 процентов\nВаш ответ: {user_answer}\n\n<i>Объяснение: Многие думают, что доступ девочек к образованию в бедных странах ограничен, но это уже не так. За последние десятилетия глобальные инициативы, такие как программы ООН и ВОЗ, существенно увеличили доступ к образованию, особенно среди девочек. Сегодня большинство девочек в странах с низким уровнем доходов оканчивают начальную школу, что свидетельствует об огромных улучшениях в области образования.\n\nUPD 2025: статус ответа остаётся верным.</i>""")

ANSWER_TEXT_2 = __("""Вопрос: 2\n\nГде живет большая часть населения мира?\n\n1) В странах с низким уровнем доходов\n2) В странах со средним уровнем доходов\n3) В странах с высоким уровнем доходов\n\nПравильно: В странах со средним уровнем доходов\nВаш ответ: {user_answer}\n\n<i>Объяснение: Раньше мир действительно был разделён на «богатые» и «бедные» страны, но сейчас большая часть населения живёт в странах со средним уровнем доходов. Это Китай, Индия и многие другие страны, где экономический рост помог миллиардам людей подняться из крайней нищеты. Большинство людей имеют доступ к базовым благам, таким как электричество, вода и образование, что подтверждает этот факт.\n\nUPD 2025: структура почти не изменилась, правильный вариант сохраняется.</i>""")

ANSWER_TEXT_3 = __("""Вопрос 3:\n\nЗа последние 20 лет доля мирового населения, живущего в нищете...\n\n1) ...почти удвоилась\n2) ...осталась почти неизменной\n3) ...сократилась почти вдвое\n\nПравильно: ...сократилась почти вдвое\nВаш ответ: {user_answer}\n\n<i>Объяснение: Это один из самых впечатляющих успехов последних десятилетий. Улучшения в сельском хозяйстве, глобальная торговля и международные программы помощи позволили миллиардам людей выбраться из бедности. Хотя многие всё ещё живут за чертой бедности, сокращение её уровня в два раза за 20 лет — это значительный прогресс.\n\nUPD 2025: если смотреть период 1995–2025, то 28%→9%, людей живущих в крайней нищете, сократилась почти втрое.</i>""")

ANSWER_TEXT_4 = __("""Вопрос 4:\n\nКакова сегодня ожидаемая продолжительность жизни в мире?\n\n1) 50 лет\n2) 60 лет\n3) 70 лет\n\nПравильно: 70 лет\nВаш ответ: {user_answer}\n\n<i>Объяснение: Ожидаемая продолжительность жизни резко увеличилась благодаря глобальному прогрессу в медицине, вакцинации и улучшению санитарных условий. Даже в беднейших странах средняя продолжительность жизни выросла. Это показывает, насколько быстро могут меняться условия жизни при доступе к базовым благам.\n\nUPD 2025: по данным ВОЗ на 2023 мировая ожидаемая продолжительность жизни составляет 73 года, книжный ответ остаётся валидным.</i>""")

ANSWER_TEXT_5 = __("""Вопрос 5:\n\nСегодня в мире насчитывается 2 миллиарда детей в возрасте от 0 до 15 лет. Сколько детей, согласно прогнозу ООН, будет в мире в 2100 году?\n\n1) 4 миллиарда\n2) 3 миллиарда\n3) 2 миллиарда\n\nПравильно: 2 миллиарда\nВаш ответ: {user_answer}\n\n<i>Объяснение: Уровень рождаемости по всему миру стабилизировался. В странах с низким доходом семьи уже не стремятся иметь много детей, так как улучшаются здравоохранение и детская смертность. Это стабилизация числа детей означает, что рост населения будет происходить за счёт увеличения продолжительности жизни, а не из-за роста рождаемости.\n\nUPD 2025: ответ в тесте остаётся актуальным.</i>""")

ANSWER_TEXT_6 = __("""Вопрос 6:\n\nПо прогнозам ООН, к 2100 году население земного шара увеличится на 4 миллиарда человек. За счет чего это произойдет?\n\n1) Будет больше детей (до 15 лет)\n2) Будет больше взрослых (от 15 до 74 лет)\n3) Будет больше стариков (от 75 лет)\n\nПравильно: Будет больше взрослых (от 15 до 74 лет)\nВаш ответ: {user_answer}\n\n<i>Объяснение: Основной прирост произойдёт за счёт увеличения числа взрослых людей, которые будут жить дольше благодаря улучшению здравоохранения. Количество детей останется стабильным, а доля пожилых людей тоже будет увеличиваться, но более медленно.\n\nUPD 2025: статус ответа полностью сохраняется.</i>""")

ANSWER_TEXT_7 = __("""Вопрос 7:\n\nКак за последние 100 лет изменилось количество смертей в год, вызванных стихийными бедствиями?\n\n1) Увеличилось более чем в два раза\n2) Осталось почти неизменным\n3) Уменьшилось более чем в два раза\n\nПравильно: Уменьшилось более чем в два раза\nВаш ответ: {user_answer}\n\n<i>Объяснение: Благодаря развитию технологий прогнозирования, улучшению инфраструктуры и международной помощи, количество смертей от стихийных бедствий сократилось. Сегодня мы способны заранее готовиться к ураганам, землетрясениям и другим катастрофам, снижая их последствия.\n\nUPD 2025: тренд сохраняется, несмотря на отдельные катастрофы.</i>""")

ANSWER_TEXT_8 = __("""Вопрос 8:\n\nСегодня население земного шара составляет около 7 миллиардов человек. Какая карта лучше всего показывает их распределение?\n\n1) Карта I\n2) Карта II\n3) Карта III\n\nПравильно: Карта I\nВаш ответ: {user_answer}\n\n<i>Объяснение: Большинство населения проживает в Азии, что делает распределение людей очень неоднородным. Около 4 миллиардов человек живут в Индии, Китае и других азиатских странах. Карта I лучше всего отражает этот факт, показывая плотное население в соответствующих регионах.\n\nUPD 2025: сейчас население Земли ≈8,2 млрд: Азия ~4,8 млрд, Африка ~1,4 млрд, Европа ~0,75 млрд, Америка ~1,05 млрд. Правильный вариант с доминированием Азии остаётся верным.</i>""")

ANSWER_TEXT_9 = __("""Вопрос 9:\n\nСколько годовалых детей в мире прививается сегодня от каких-либо болезней?\n\n1) 20 процентов\n2) 50 процентов\n3) 80 процентов\n\nПравильно: 80 процентов\nВаш ответ: {user_answer}\n\n<i>Объяснение: Вопреки распространённым мифам, большинство детей в мире получают базовые прививки. Это стало возможным благодаря международным программам, таким как Глобальный альянс по вакцинам (GAVI), и поддержке со стороны ВОЗ. Эти усилия помогли уменьшить уровень детской смертности и предотвратить многие заболевания.\n\nUPD 2025: по оценкам ВОЗ/ЮНИСЕФ охват ключевыми детскими вакцинами к 2023 составляет порядка 85-90% в среднем по миру. Между 20/50/80 правильным остаётся 80%.</i>""")

ANSWER_TEXT_10 = __("""Вопрос 10:\n\nВ среднем по миру к 30 годам мужчины тратят на учебу 10 лет своей жизни. Сколько лет тратят на учебу к тому же возрасту женщины?\n\n1) 9 лет\n2) 6 лет\n3) 3 года\n\nПравильно: 9 лет\nВаш ответ: {user_answer}\n\n<i>Объяснение: Разрыв в образовании между мужчинами и женщинами существенно сократился за последние десятилетия. Сегодня девочки имеют почти такие же возможности для обучения, как и мальчики, что способствует улучшению их положения в обществе.\n\nUPD 2025: по данным UNDP глобальный разрыв по образованию между полами продолжает сокращаться. Статус ответа остаётся верным.</i>""")

ANSWER_TEXT_11 = __("""Вопрос 11:\n\nВ 1996 году тигры, гигантские панды и черные носороги вошли в список вымирающих видов. Сколько из этих трёх видов сегодня находятся под угрозой исчезновения?\n\n1) Два\n2) Один\n3) Ни одного\n\nПравильно: Ни одного\nВаш ответ: {user_answer}\n\n<i>Объяснение: Усилия по сохранению природы, такие как создание заповедников и борьба с браконьерством, позволили восстановить численность этих видов. Хотя угрозы полностью не исчезли, они больше не находятся на грани исчезновения, что является результатом глобальных природоохранных инициатив.\n\nUPD 2025: все три вида всё ещё считаются угрожаемыми, но тренд положительный - популяции восстанавливаются. Статус ответа остаётся верным.</i>""")

ANSWER_TEXT_12 = __("""Вопрос 12:\n\nСколько человек в мире имеют доступ к электричеству?\n\n1) 20 процентов\n2) 50 процентов\n3) 80 процентов\n\nПравильно: 80 процентов\nВаш ответ: {user_answer}\n\n<i>Объяснение: Сегодня около 80% мирового населения имеют доступ к электричеству. Это стало возможным благодаря развитию энергетической инфраструктуры, даже в отдалённых районах. Этот показатель особенно заметно улучшился в странах с низким уровнем доходов.\n\nUPD 2025: электрификация выросла с ~80 до ~90%, среди вариантов 20/50/80 правильным остаётся 80%</i>""")

ANSWER_TEXT_13 = __("""Вопрос 13:\n\nЭксперты по глобальному климату считают, что в течение следующих 100 лет средняя температура...\n\n1) ...повысится\n2) ...останется неизменной\n3) ...понизится\n\nПравильно: ...повысится\nВаш ответ: {user_answer}\n\n<i>Объяснение: Из-за увеличения концентрации парниковых газов в атмосфере глобальное потепление продолжит набирать обороты. Учёные прогнозируют рост температуры, если не будут приняты меры по сокращению выбросов CO₂ и других вредных веществ.\n\nUPD 2025: научный консенсус не изменился, 2024 год признан самым тёплым в истории наблюдений.</i>""")

# Обновленный словарь
correct_answers = {
    1: ANSWER_TEXT_1,
    2: ANSWER_TEXT_2,
    3: ANSWER_TEXT_3,
    4: ANSWER_TEXT_4,
    5: ANSWER_TEXT_5,
    6: ANSWER_TEXT_6,
    7: ANSWER_TEXT_7,
    8: ANSWER_TEXT_8,
    9: ANSWER_TEXT_9,
    10: ANSWER_TEXT_10,
    11: ANSWER_TEXT_11,
    12: ANSWER_TEXT_12,
    13: ANSWER_TEXT_13
}

# # словь ответов
# answer_options = {
#     1 : { 1: "20 процентов",
#           2: "40 процентов",
#           3: "60 процентов"},
#     2 : {1: "В странах с низким уровнем доходов",
#           2: "В странах со средним уровнем доходов",
#           3: "В странах с высоким уровнем доходов"},
#     3 : {1: "...почти удвоилась",
#           2: "...осталась почти неизменной",
#           3: "...сократилась почти вдвое"},
#     4 : {1: "50 лет",
#           2: "60 лет",
#           3: "70 лет"},
#     5 : {1: "4 миллиарда",
#           2: "3 миллиарда",
#           3: "2 миллиарда"},
#     6 : {1: "Будет больше детей (до 15 лет)",
#           2: "Будет больше взрослых (от 15 до 74 лет)",
#           3: "Будет больше стариков (от 75 лет)"},
#     7 : {1: "Увеличилось более чем в два раза",
#           2: "Осталось почти неизменным",
#           3: "Уменьшилось более чем в два раза"},
#     8 : {1: "Карта I",
#           2: "Карта II",
#           3: "Карта III"},
#     9 : {1: "20 процентов",
#           2: "50 процентов",
#           3: "80 процентов"},
#     10 : {1: "9 лет",
#           2: "6 лет",
#           3: "3 года"},
#     11 : {1: "Два",
#           2: "Один",
#           3: "Ни одного"},
#     12 : {1: "20 процентов",
#           2: "50 процентов",
#           3: "80 процентов"},
#     13 : {1: "...повысится",
#           2: "...останется неизменной",
#           3: "...понизится"}
# }

# Константы для вариантов ответов
OPTION_1_1 = __("20 процентов")
OPTION_1_2 = __("40 процентов")
OPTION_1_3 = __("60 процентов")

OPTION_2_1 = __("В странах с низким уровнем доходов")
OPTION_2_2 = __("В странах со средним уровнем доходов")
OPTION_2_3 = __("В странах с высоким уровнем доходов")

OPTION_3_1 = __("...почти удвоилась")
OPTION_3_2 = __("...осталась почти неизменной")
OPTION_3_3 = __("...сократилась почти вдвое")

OPTION_4_1 = __("50 лет")
OPTION_4_2 = __("60 лет")
OPTION_4_3 = __("70 лет")

OPTION_5_1 = __("4 миллиарда")
OPTION_5_2 = __("3 миллиарда")
OPTION_5_3 = __("2 миллиарда")

OPTION_6_1 = __("Будет больше детей (до 15 лет)")
OPTION_6_2 = __("Будет больше взрослых (от 15 до 74 лет)")
OPTION_6_3 = __("Будет больше стариков (от 75 лет)")

OPTION_7_1 = __("Увеличилось более чем в два раза")
OPTION_7_2 = __("Осталось почти неизменным")
OPTION_7_3 = __("Уменьшилось более чем в два раза")

OPTION_8_1 = __("Карта I")
OPTION_8_2 = __("Карта II")
OPTION_8_3 = __("Карта III")

OPTION_9_1 = __("20 процентов")
OPTION_9_2 = __("50 процентов")
OPTION_9_3 = __("80 процентов")

OPTION_10_1 = __("9 лет")
OPTION_10_2 = __("6 лет")
OPTION_10_3 = __("3 года")

OPTION_11_1 = __("Два")
OPTION_11_2 = __("Один")
OPTION_11_3 = __("Ни одного")

OPTION_12_1 = __("20 процентов")
OPTION_12_2 = __("50 процентов")
OPTION_12_3 = __("80 процентов")

OPTION_13_1 = __("...повысится")
OPTION_13_2 = __("...останется неизменной")
OPTION_13_3 = __("...понизится")

# Обновленный словарь
answer_options = {
    1: {1: OPTION_1_1, 2: OPTION_1_2, 3: OPTION_1_3},
    2: {1: OPTION_2_1, 2: OPTION_2_2, 3: OPTION_2_3},
    3: {1: OPTION_3_1, 2: OPTION_3_2, 3: OPTION_3_3},
    4: {1: OPTION_4_1, 2: OPTION_4_2, 3: OPTION_4_3},
    5: {1: OPTION_5_1, 2: OPTION_5_2, 3: OPTION_5_3},
    6: {1: OPTION_6_1, 2: OPTION_6_2, 3: OPTION_6_3},
    7: {1: OPTION_7_1, 2: OPTION_7_2, 3: OPTION_7_3},
    8: {1: OPTION_8_1, 2: OPTION_8_2, 3: OPTION_8_3},
    9: {1: OPTION_9_1, 2: OPTION_9_2, 3: OPTION_9_3},
    10: {1: OPTION_10_1, 2: OPTION_10_2, 3: OPTION_10_3},
    11: {1: OPTION_11_1, 2: OPTION_11_2, 3: OPTION_11_3},
    12: {1: OPTION_12_1, 2: OPTION_12_2, 3: OPTION_12_3},
    13: {1: OPTION_13_1, 2: OPTION_13_2, 3: OPTION_13_3}
}



# хэндлер обработки inline кнопки "Правильные ответы" (correct_answers)
@correct_answer_router.callback_query(F.data == "correct_answers")
async def correct_answers_callback(callback_query: CallbackQuery, state: FSMContext, session: AsyncSession, workflow_data: dict):
    user_id = callback_query.from_user.id
    text = _("Вы прошли тест!\n\nДавайте рассмотрим каждый вопрос, "
            "правильные ответы и разберём, почему именно они являются верными.")
    reply_markup = keyboard.get_callback_btns(
        btns={_('Дальше'):'repeat_start',
              _('↩️ Назад'): 'back_to_main'},
        sizes=(1,1))
    new_message = await callback_query.message.edit_text(
        text=text,
        reply_markup=reply_markup) # type: ignore

    # data = await state.get_data()
    # correct_answers_num = data.get('correct_answers_num', 1)
    # await state.update_data(correct_answers_num=correct_answers_num)
    await state.update_data(last_message_id=new_message.message_id)
    await callback_query.answer()

    analytics = workflow_data['analytics']
    await analytics(user_id=user_id,
                    category_name="/info",
                    command_name="/correct_answers")

# хэндлер обработки inline кнопок repeat_next и repeat_back
@correct_answer_router.callback_query(F.data.startswith("repeat_"))
async def correct_answers_repeat(callback_query: CallbackQuery, state: FSMContext, session: AsyncSession, workflow_data: dict):
    user_id = callback_query.from_user.id
    fsm_data = await state.get_data()
    correct_answers_num = fsm_data.get('correct_answers_num', 1)
    turn_data = callback_query.data.split("_")[-1]
    if turn_data == "next":
        correct_answers_num=correct_answers_num + 1
    elif turn_data == "back":
        correct_answers_num=correct_answers_num - 1

    if correct_answers_num == 1:
        reply_markup = keyboard.get_callback_btns(btns={
            ' ➡️ ':'repeat_next',
            _('↩️ Назад'): 'back_to_main'},sizes=(1,1))
    elif 1 < correct_answers_num < 13:
        reply_markup = keyboard.get_callback_btns(btns={
            ' ⬅️ ':'repeat_back',
            ' ➡️ ':'repeat_next',
            _('↩️ Назад'): 'back_to_main'},sizes=(2,1))
    else:
        reply_markup = keyboard.get_callback_btns(btns={
            ' ⬅️ ':'repeat_back',
            _('↩️ Назад'): 'back_to_main'},sizes=(1,1))

    text = correct_answers[correct_answers_num]
    user_answer_col = 'answer_' + str(correct_answers_num)
    user_answer_num: int = int(fsm_data.get(user_answer_col, 0))
    user_answer_num = user_answer_num if user_answer_num != 0 else getattr(await orm_get_answer(session, user_id), user_answer_col, 1)

    user_answer = answer_options[correct_answers_num][user_answer_num]

    new_message = await callback_query.message.edit_text(
        text=text.format(user_answer=user_answer),
        reply_markup=reply_markup) # type: ignore

    await state.update_data(correct_answers_num=correct_answers_num)
    await state.update_data(last_message_id=new_message.message_id)
    await callback_query.answer()

    analytics = workflow_data['analytics']
    await analytics(user_id=user_id,
                    category_name="/info",
                    command_name="/correct_answers")
